---
layout: default
title: Spine для Playables
permalink: /how-to-spine/
---

### Спайн-анимация для плееблов.

Подготовка спайн-анимации для плееблов имеет ряд отличий от подготовки спайн-анимаций для любых других проектов.

### Основные тезисы

Весь плеебл, как правило, должен занимать не больше 5 мбайт, в очень редких случаях его вес должен быть 2-2.5 мбайта. 

В эти 5 мбайт билда должны вмещаться код, вся статика (ui, фоны, пропсы, эффекты), звук с музыкой, и, наконец, спайн анимации. 

На выходе у аниматора есть 1-2 мбайта веса, чтобы разгуляться. Не густо. Но и с этим можно работать.

Второй важный момент - сами анимации должны быть максимально лёгкими: аниматор должен максимально ограничить себя в использовании фичей вроде мешей и констрейнов.

Почему так? Эти анимации проигрываются в игре в собственном движке или браузере. Игра в игре, подтянутая извне. Такие игры должны проигрываться одинаково хорошо на всём спектре устройств: от допотопных калькуляторов и чайников, до стиральных машин с утюгами. Это условие тяжело поддерживать, если у нас будет костей чуть больше 50, в меше будет вертексов чуть больше четырёх, весов на вертекс больше двух, и тд. Об этом чуть ниже. 

Пример метрики одного из легковесных персонажей, у которого оставался простор для оптимизации:

![]({{}}/images/howtospine/spinemetrics.png)

### Весе и организация скелета

Вес экспорта зависит от двух вещей: размер атласа и вес анимации в json. 

Json будет лёгким, если мы не нагрузим проект большим количеством костей, это в свою очередь зависит от того, сколько анимаций, костей и ключей в этих анимациях задействовано. 

Есть простое правило: руки состоят из трёх костей: плеча(hand), предплечья (arm), кисти(palm)  (названия в скобках условное), ноги состоят тоже из трёх частей: бедро (hip/leg), голень(shin), стопа(boot). Тело из одной-двух костей, шею по возможности  смёржить с телом, голова отдельно. 

Зрачки и части лица вроде бровей лучше мёржить вместе, и делорганизовать эмоции списком аттачментов к слоту. Если есть необходимость в анимации волос-тканей, не больше 1-3 костей на сущность. 

Обычный скелет персонажа из HC:

![]({{}}/images/howtospine/skeletonexample.png)

Сохраните себе нервы - сделайте кость под рутом, назвав её container, scale или main - на скрине выше есть и Container и Main. Это обусловлено тем, что арт персонажей часто присылается в размере x2, x1.5, x3 и аниматор вынужден на своей стороне скейлить скелет до нужного в игре размера. Кость root нельзя трогать вообще ни в каких анимациях (ни вращать, ни скейлить), поэтому для скейла скелета в нужный размер, используется кость вроде Container, Main или с любым другим названием. 

Все остальные части скелета находятся в иерархии под этими костями. Container скейлится в setup, а Main можно изменять внутри анимации - если того требует дело. 

### Нейминг, регламент и скина

Короткие названия из трёх-четырёх букв работают лучше на длинной дистанции разработки, когда надо быстро ориентироваться в куче скелетов и иметь свой собственный общий регламент. К делу не сильно относится, но работающей практикой является переименование частей тела с одной стороны и другой по регламенту: всё, что слева от зрителя это Left, всё, что справа - Right, на момент рига. Таким образом левая рука будет названа HandLeft, ArmLeft, PalmLeft, а правая от зрителя рука HandRight, ArmRight, PalmRight и так далее. 

Иногда разработчики просят переменовывать кости в соответствии с их внутренними правилами, дашбоардами и регламентами. Например, использовать только строчные буквы, а части слов в нейминге разделять дефисом: ArmLeft становится arm-left. Это легко изменить с помощью инструмента поиска в спайне. 

![]({{}}/images/howtospine/searchusing.png)

При необходимости использовать IK перед названием кости, можно прописать префикс IK_, в этом случае BootLeft, на которую будет завязана кинематика ноги (HipLeft > ShinLeft) будет иметь название IK_BootLeft. 

![]({{}}/images/howtospine/ikreglament.png)

В примере я использовал 4 IK кости, две для стоп, две для кистей. Обычно, можно оставлять только стопы, но здесь было много анимаций с оружием и предметом, и нужен был чуть больший контроль в движении, чем обычно. Лучше избежать большого количества IK. 

В проектах часто приходится делать много скинов, поэтому работа сопряжена с частым переименованием аттачментов-спрайтов-изображений в нужный формат. Есть лёгкое решение: в графическом редакторе добавить базовому скину постфикс _base, _hero или _main, а всем остальным другие постфиксы: рыцарю, например _knight. В этом случае, заригав один скин, мы сдублируем его и в поиске просто переименуем _hero в _knight, и всё сработает. Местами иногда требуется поднастроить-подвигать спрайты в спайне. 

Причина такого решения: разработчики плееблов работают в разных движках: construct3, pixiJS, Phaser, Cocos, Unity, TreeJS, Defold, и многих других. Каждый движок имеет разные поддержки рантайма спайн: кто-то ест последнюю свежую стабильную версию спайна, кто-то застрял на древней 3.6. Какие-то движки хорошо используют пути к скинам в папках /skin/handright.png, какие-то нет. 

Для себя отмечу, что использовать подпапки в скинах - плохой тон, этот способ нестабилен, и работает через раз. Даже в крупных красивых больших проектах на заряженных успехом движках подпапки в скинах могут потребовать переделки в систему с постфиксами в названии и уходе от подпапок. 

Пример организации такого варианта. 

![]({{}}/images/howtospine/skinsexample.png)

### Оптимизация анимации, мешей и арта. 

Аниматор плееблов это больше технический аниматор, чем аниматор творческий. Чем меньше ключей, тем лучше, чем меньше костей, тем лучше, чем меньше мешей, тем лучше. 

В идеале должно срабатывать правило, указанное выше - на часть тела не больше трёх костей, где можно избежать костей, лучше их убрать. Эмоции нужно аттачить к одному слоту, и менять их в анимации. Их количество лучше сократить. 

Анимация Idle может быть подкручена тремя костями, например. 

![]({{}}/images/howtospine/idleexample.png)

Аниматор плееблов это не про rich-анимацию, это про техничность испольнения, урезание своего творческого позыва сделать красиво и про сильные рамки и ограничения. 



[email@domain.com](mailto:email@domain.com)